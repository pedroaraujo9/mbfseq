% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calibrate_lambda.R
\name{find_map}
\alias{find_map}
\title{Find MAP Estimates via Hierarchical Clustering and Stan Optimization}
\usage{
find_map(lambda, model, model_data, fixed_sd = 10)
}
\arguments{
\item{lambda}{Penalty or regularization hyperparameter(s) passed to Stan and the optimizer.}

\item{model}{A compiled Stan model object (see rstan).}

\item{model_data}{A model_data object (from create_model_data) containing all basis, grouping, and index info.}

\item{fixed_sd}{Numeric. Fixed standard deviation for prior/penalty in the model (default: 10).}
}
\value{
A list with components:
\describe{
\item{opt_fit}{The result of Stan MAP optimization (see rstan::optimizing).}
\item{w_ward}{Vector of clusters assigned by Ward hierarchical clustering on Hamming distances (z_ham_dist in model_data).}
}
}
\description{
Internal: Compute a maximum a posteriori estimate (MAP) of model parameters and cluster structure using hierarchical clustering for initialization and Stan optimization for parameter estimation.
}
\details{
Runs hierarchical clustering (hclust with Ward's method) on the Hamming distance between sequences to obtain initial clusters. Clusters are used to generate a model matrix (W), which, along with basis expansions and model indices, form the Stan data list. Runs MAP optimization using the LBFGS algorithm via rstan. Intended for internal use.
}
\keyword{internal}
